<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Details Booking graph</title>
  <link rel="stylesheet" href="detailstyle.css">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;

    }

    .sidebar {
      background-color: #f0d3b8;
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 290px;
      max-width: 290px;
      /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á Sidebar */
      padding: 20px;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      z-index: 1000;
    }

    .content-area {

      margin-left: 290px;
      /* ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á Sidebar */
      padding: 20px;
      /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô */
      background-color: #f8f9fa;
      /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ */
    }

    /* Responsive: ‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å */
    @media (max-width: 576px) {
      .sidebar {
        position: relative;
        width: 100%;
        max-width: 100%;
        box-shadow: none;
      }

      .content-area {
        margin-left: 0;
      }
    }

    .sidebar .btn:last-child {
      margin-top: auto;
      /* ‡∏î‡∏±‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î */
    }
  </style>
</head>

<body>
  <div id="sidebar-container"></div>


  <div class="content-area">
    <div class="container">
      <header>

        <button id="openPopup" style="margin-left: 80%;">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>

      </header>

      <body>
        <div id="popup" class="popup">
          <div class="popup-content">
            <span id="closePopup" class="close-btn">&times;</span>
            <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</h2>
            <ul>
              <li><button class="filter-option" data-filter="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button></li>
              <li><button class="filter-option" data-filter="today">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button></li>
              <li><button class="filter-option" data-filter="yesterday">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô‡∏ô‡∏µ‡πâ</button></li>
              <li><button class="filter-option" data-filter="this-week">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</button></li>
              <li><button class="filter-option" data-filter="last-week">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</button></li>
              <li><button class="filter-option" data-filter="this-month">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button></li>
              <li><button class="filter-option" data-filter="last-month">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</button></li>
              <li><button class="filter-option" data-filter="this-year">‡∏õ‡∏µ‡∏ô‡∏µ‡πâ</button></li>
              <li><button class="filter-option" data-filter="last-year">‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</button></li>

              <!-- ‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô -->
              <label for="startDate">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:</label>
              <input type="date" id="startDate">

              <!-- ‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î -->
              <label for="endDate">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î:</label>
              <input type="date" id="endDate" style="display:none;"> <!-- ‡∏ã‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô -->
            </ul>
          </div>
        </div>
        <div style="display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;">
          <section><canvas id="barChart" style="height: 300px; width: 100%; "></canvas></section>
          <section style="align-items: center;
        justify-content: center;
        text-align: center;
        font-family: sans-serif;">
           <h2>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h2>
           <p id="totalCount" style="font-size: 30px;">Loading...</p>
           <br>
           <p id="csCount" style="font-size: 30px;">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå: Loading...</p>
           <p id="itCount" style="font-size: 30px;">‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®: Loading...</p>
            <button onclick="window.location.href='graphdetail.html';" style="border-radius: 5px;
            background-color: purple;">Details</button>
          </section>

        </div>

        <button onclick="window.location.href='alldata.html'">BACK</button>

      </body>
      <script>
        // ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î Popup
        const openPopupBtn = document.getElementById("openPopup");
        const popup = document.getElementById("popup");
        const closePopupBtn = document.getElementById("closePopup");
        const startDateInput = document.getElementById("startDate");
        const endDateInput = document.getElementById("endDate");

        openPopupBtn.addEventListener("click", () => {
          popup.style.display = "flex"; // ‡πÄ‡∏õ‡∏¥‡∏î Popup
        });

        closePopupBtn.addEventListener("click", () => {
          popup.style.display = "none"; // ‡∏õ‡∏¥‡∏î Popup
        });

        window.addEventListener("click", (e) => {
          if (e.target === popup) {
            popup.style.display = "none"; // ‡∏õ‡∏¥‡∏î Popup ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å Popup
          }
        });

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        startDateInput.addEventListener("change", () => {
          const startDate = startDateInput.value;
          if (startDate) {
            // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î
            endDateInput.style.display = "inline-block";

            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            const endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + 1); // ‡πÄ‡∏û‡∏¥‡πà‡∏° 1 ‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô

            // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô input[type="date"]
            const endDateString = endDate.toISOString().split("T")[0];

            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î
            endDateInput.value = endDateString;

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏õ‡∏∏‡πà‡∏° #openPopup
            openPopupBtn.textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤: ${startDate} ‡∏ñ‡∏∂‡∏á ${endDateString}`;
          }
        });

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î
        endDateInput.addEventListener("change", () => {
          const startDate = startDateInput.value;
          const endDate = endDateInput.value;
          if (startDate && endDate) {
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏õ‡∏∏‡πà‡∏°
            openPopupBtn.textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤: ${startDate} ‡∏ñ‡∏∂‡∏á ${endDate}`;
            popup.style.display = "none"; // ‡∏õ‡∏¥‡∏î Popup ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
          }
        });

        // ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏ô popup ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ
        const filterOptions = document.querySelectorAll(".filter-option");

        filterOptions.forEach((option) => {
          option.addEventListener("click", (e) => {
            const selectedFilter = e.target.dataset.filter;
            console.log("Selected Filter:", selectedFilter);
            openPopupBtn.textContent = e.target.textContent; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏õ‡∏∏‡πà‡∏°
            popup.style.display = "none"; // ‡∏õ‡∏¥‡∏î Popup ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
          });
        });
        fetch('http://localhost:3000/daysroom')
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then(data => {
            console.log("Fetched Data:", data); // üõ† Debug: ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• API

            const barCtx = document.getElementById('barChart').getContext('2d');
            if (!barCtx) {
              console.error("Canvas element not found!");
              return;
            }

            // Prepare data for the Chart.js chart after fetching
            const labels2 = data.map(item => item.DayName);
            const totalCount2 = data.map(item => item.TotalCount);
            const csCount2 = data.map(item => item.Cs);
            const itCount2 = data.map(item => item.It);

            new Chart(barCtx, {
              type: 'bar',
              data: {
                labels: labels2,
                datasets: [
                  {
                    label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏¥‡∏™‡∏¥‡∏ï ‡∏™‡∏≤‡∏Ç‡∏≤ ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏Ø',
                    data: csCount2,
                    backgroundColor: '#E54715'
                  },
                  {
                    label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏¥‡∏™‡∏¥‡∏ï ‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Ø',
                    data: itCount2,
                    backgroundColor: '#622BBE'
                  }
                ]
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    position: 'bottom', // Position legend at the bottom
                    labels: {
                      font: {
                        size: 20 // üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á legend
                      }
                    }
                  },
                  title: {
                    display: true,
                    text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏¥‡∏™‡∏¥‡∏ï',
                    font: {
                      size: 16 // üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á title
                    }
                  }
                },
                scales: {
                  x: {
                    ticks: {
                      font: {
                        size: 16 // üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á labels ‡∏ö‡∏ô‡πÅ‡∏Å‡∏ô X
                      }
                    }
                  },
                  y: {
                    beginAtZero: true,
                    ticks: {
                      callback: function (value) {
                        return Math.floor(value); // üî• ‡∏õ‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡∏≠‡∏≠‡∏Å
                      },
                      font: {
                        size: 16 // üî• ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á labels ‡∏ö‡∏ô‡πÅ‡∏Å‡∏ô Y
                      }
                    }
                  }
                }
              }
            });
          })
          .catch(error => {
            console.error('Error fetching data:', error);
          });
          fetch('http://localhost:3000/detailsdaysroom')
    .then(response => response.json())
    .then(data => {
      console.log(data); // ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å API

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô data
      const totalCount = data && data[0] ? data[0].TotalCount : 0;
      const csCount = data && data[0] ? data[0].Cs : 0;
      const itCount = data && data[0] ? data[0].It : 0;

      console.log('TotalCount:', totalCount);
      console.log('Cs:', csCount);
      console.log('It:', itCount);

      // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ null ‡∏´‡∏£‡∏∑‡∏≠ undefined
      const totalCountNum = totalCount ? parseInt(totalCount, 10) : 0;
      const csCountNum = csCount ? parseInt(csCount, 10) : 0;
      const itCountNum = itCount ? parseInt(itCount, 10) : 0;

      console.log('Converted TotalCount:', totalCountNum);
      console.log('Converted Cs:', csCountNum);
      console.log('Converted It:', itCountNum);

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô HTML
      document.getElementById('totalCount').textContent = `${totalCountNum} ‡∏Ñ‡∏ô`;
      document.getElementById('csCount').textContent = `‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå ${csCountNum} ‡∏Ñ‡∏ô`;
      document.getElementById('itCount').textContent = `‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏® ${itCountNum} ‡∏Ñ‡∏ô`;
    })
    .catch(error => {
      console.error('Error fetching data:', error);
      document.getElementById('totalCount').textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
    });
       // fetch sidebar
       fetch("sidebar.html")
      .then((resp) => resp.text())
      .then((html) => {
        // ‡πÅ‡∏ó‡∏£‡∏Å Sidebar ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
        document.getElementById("sidebar-container").innerHTML = html;
      })
      .then(() => {
        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß Sidebar ‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô DOM ‡πÅ‡∏•‡πâ‡∏ß
        // ‡πÉ‡∏´‡πâ Highlight ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        const btnStats = document.getElementById("btnStatistic");
        btnStats.classList.add("btn-sidebar-active");
      })
      .catch((err) => console.error("Failed to load sidebar:", err));
    // end of fetch sidebar
      </script>

</html>