<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floor Layout</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: #d9c1ab;
        }

        header {
            background-color: #d9c1ab;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-bottom: 2px solid #000;
        }

        .floor-buttons {
            display: flex;
            gap: 15px;
        }

        .floor-buttons button {
            background-color: #6c34a3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
        }

        .floor-buttons button:hover {
            background-color: #563080;
        }

        main {
            display: flex;
            flex: 1;
        }

        .layout {
            flex: 3;
            background-color: white;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(7, 1fr);
            grid-gap: 5px;
            padding: 20px;
            border: 2px solid #000;
            position: relative;
        }

        .circle {
            content: 'ไม่ว่าง';
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background-color: red;
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            color: white;
        }

        .room {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            text-align: center;
            border: 2px solid #000;
            border-radius: 10px;
            background-color: red;
            color: white;
            transition: background-color 0.3s, transform 0.2s;
        }

        .room:hover {
            transform: scale(1.1);
        }

        .space {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .space.large {
            grid-column: span 2;
            grid-row: span 2;
        }

        .space.smalls {
            grid-column: span 1;
            grid-row: span 2;
        }

        .room.large {
            grid-column: span 2;
            grid-row: span 2;
            background-color: red;
        }

        .room.vertical {
            grid-row: span 2;
            background-color: red;
        }

        .room.small {
            grid-column: span 1;
            grid-row: span 1;
            background-color: red;
        }

        .room.men {
            grid-column: span 1;
            grid-row: span 1;
            background-color: red;
        }

        .room.women {
            grid-column: span 1;
            grid-row: 2;
            grid-column: 10;
            background-color: red;
        }

        .room.large.bottom {
            grid-column: 1 / span 1;
            grid-row: 6 / span 2;
            background-color: grey;
        }

        .room.large.bottom2 {
            grid-column: 2 / span 1;
            grid-row: 6 / span 2;
            background-color: grey;
        }

        .room.large.bottom3 {
            grid-column: 3 / span 1;
            grid-row: 6 / span 2;
            background-color: red;
        }

        .room.large.bottom4 {
            grid-column: 6 / span 2;
            grid-row: 6 / span 2;
            background-color: red;
        }

        .room.large.bottom5 {
            grid-column: 8 / span 2;
            grid-row: 6 / span 2;
            background-color: red;
        }

        .room.large.bottom6 {
            grid-column: 12 / span 1;
            grid-row: 6 / span 2;
            background-color: red;
        }

        .room.smallss.bottoms1 {
            grid-column: 4 / span 1;
            grid-row: 7 / span 1;
            background-color: red;
        }

        .room.available::before {
            content: "ว่าง";
            /* Default content is "Not Available" */
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background-color: green;
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            color: white;
        }

        .room.not-available::before {
            content: "ไม่ว่าง";
            /* Default content is "Not Available" */
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background-color: red;
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            color: white;
        }



        .center {
            align-items: center;
            grid-column: 5 / span 6;
            grid-row: 4 / span 1;
            border: 2px solid #000;
            border-radius: 15px;
            background-color: #fff;
        }

        .sidebar {
            flex: 1;
            background-color: #f8f9fa;
            padding: 20px;
            display: flex;
            flex-direction: column;
            border-left: 2px solid #000;
        }

        .sidebar h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .categories {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
        }

        .categories li {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #000000;
            border-radius: 20px;
            background-color: #fff;
        }

        .categories li span {
            background-color: #eb0f0f;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
        }

        .reports {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .report {
            background-color: #fff3cd;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #000000;
            border-radius: 5px;
        }

        .search-bar input {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #000000;
            border-radius: 5px;
        }

        .reques {
            text-align: center;

        }

        .reques button {
            background-color: rgb(37, 196, 37);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            border-color: #000;
            margin-right: auto;
        }

        .reques button:hover {
            background-color: rgb(37, 196, 37);
            border-color: #000000
        }

        .requess {
            text-align: center;

        }

        .requess button {
            background-color: rgb(37, 196, 37);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            border-color: #000;
            margin-right: auto;
        }

        .requess button:hover {
            background-color: rgb(37, 196, 37);
            border-color: #000000
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;

            padding: 15px;

            border: 1px solid #888;
            width: 50%;

            border-radius: 10px;

            max-width: 400px;

        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        button {
            padding: 10px 20px;
            background-color: #6c34a3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #563080;
        }

        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .popup.hidden {
            display: none;
        }

        .popup-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            width: 300px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        button {
            padding: 10px 20px;
            background-color: #6c34a3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #563080;
        }

        .status-dropdown {
            position: absolute;
            bottom: 10px;
            right: 10px;
            padding: 5px;
            font-size: 12px;
            border-radius: 5px;
            border: 1px solid #000;
            cursor: pointer;
        }

        #room-status {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #000;
            font-size: 14px;
        }

        .popup-actions {
            margin-top: 20px;
            text-align: center;
        }

        #confirm-button {
            background-color: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        #confirm-button:hover {
            background-color: #45a049;
        }

        header {
            background-color: #d9c1ab;
            padding: 10px;
            display: flex;
            align-items: center;
            border-bottom: 2px solid #000;
        }

        .floor-buttons {
            display: flex;
            gap: 15px;
        }

        .report-buttons {
            display: flex;
            gap: 15px;
            margin-left: auto;
        }

        .floor-buttons button {
            background-color: #6c34a3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
        }

        .floor-buttons button:hover {
            background-color: #563080;
        }

        .floor-buttons button:active {
            box-shadow: inset 0px 4px 6px rgba(0, 0, 0, 0.4);
        }

        .report-buttons button {
            background-color: rgb(37, 196, 37);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
        }

        .report-buttons button:hover {
            background-color: rgb(30, 170, 30);
        }

        .report-buttons button:active {
            box-shadow: inset 0px 4px 6px rgba(0, 0, 0, 0.4);
        }

        .logout-button {
            margin-left: 15px;
        }

        .floor-buttons button {
            background-color: #6c34a3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
        }

        .floor-buttons button:hover {
            background-color: #563080;
        }

        .floor-buttons button:active {
            box-shadow: inset 0px 4px 6px rgba(0, 0, 0, 0.4);
        }

        .report-buttons button {
            background-color: rgb(37, 196, 37);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
        }

        .report-buttons button:hover {
            background-color: rgb(30, 170, 30);
        }

        .report-buttons button:active {
            box-shadow: inset 0px 4px 6px rgba(0, 0, 0, 0.4);
        }

        .logout-button button {
            background-color: orange;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
        }

        .logout-button button:hover {
            background-color: rgb(179, 117, 0);
        }

        .logout-button button:active {
            box-shadow: inset 0px 4px 6px rgba(0, 0, 0, 0.4);
        }

        #roomDetailsButton {
            margin-top: 10px;
            padding: 10px 20px;
            background-color: #6c34a3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #roomDetailsButton:hover {
            background-color: #4CBB17;
        }

        .room.closed::before {
            content: "ซ่อม\Aบำรุง";
            color: black;
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background-color: #eed202;
            border: 2px solid black;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            color: white;
        }

        #roomDetailsButton {
            margin-top: 10px;
            padding: 10px 20px;
            background-color: #009E60;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #roomDetailsButton:hover {
            background-color: #40826D;
        }

        #scheduleContent {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background-color: #f9f9f9;
        }
    </style>
</head>

<body>
    <header>
        <div class="floor-buttons">
            <a href="floor2.html"><button>ชั้น 2</button></a>
            <a href="floor3.html"><button>ชั้น 3</button></a>
            <a href="Index.html"><button>ชั้น 4</button></a>
        </div>
        <div class="report-buttons">
            <a href="user_requests.html"><button>คำร้องขอใช้งานห้อง</button></a>
            <a href="request_crash_equipments.html"><button>รายงานอุปกรณ์ชำรุด</button></a>
        </div>
        <div class="logout-button">
            <button>ออกจากระบบ</button>
        </div>
    </header>
    <main>
        <div class="layout">
            <div class="space large"></div>
            <div class="space small"></div>
            <div class="room small">SC2-213</div>
            <div class="space smalls"></div>
            <div class="room large">SC2-214</div>
            <div class="room large">SC2-215</div>
            <div class="room men">ห้องสุขา อจ ชาย</div>
            <div class="room women">ห้องสุขา อจ หญิง</div>
            <div class="space smalls"></div>
            <div class="room vertical">SC2-201</div>
            <div class="room large bottom2 available" id="SC2-211" data-details-url="test211.html"
                onclick="manageRoom('SC2-211')">SC2-211</div>
            <div class="room large bottom available" id="SC2-212" data-details-url="test212.html"
                onclick="manageRoom('SC2-212')">SC2-212</div>


            <div class="room large bottom3">SC2-210</div>
            <div class="room smallss bottoms1">SC2-209</div>
            <div class="room large bottom4">SC2-208</div>
            <div class="room large bottom5">SC2-207</div>
            <div class="room large bottom6">SC2-206</div>
        </div>
    </main>
    <!-- Place this modal inside the <body> tag of the second code -->
    <div id="roomModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="roomDetailTitle">Room Details</h2>
            <button id="roomDetailsButton">รายละเอียดภายในห้อง</button>
            <button id="scheduleButton">ตารางการใช้ห้อง</button>

            <div>
                <label for="status">สถานะห้อง :</label>
                <select id="status">
                    <option value="available">ว่าง</option>
                    <option value="not-available">ไม่ว่าง</option>
                    <option value="closed">ซ่อมบำรุง</option>
                </select>
            </div>
            <button id="saveStatus">Save Status</button>
        </div>
    </div>
    </div>
    </div>
    </div>
    <script>
        const modal = document.getElementById("roomModal");
        const closeModal = document.querySelector(".close");
        const saveStatusButton = document.getElementById("saveStatus");
        const statusSelect = document.getElementById("status");
        const roomDetailTitle = document.getElementById("roomDetailTitle");
        const equipmentDropdown = document.getElementById("equipmentDropdown");
        const newEquipmentInput = document.getElementById("newEquipment");
        const equipmentQuantityInput = document.getElementById("equipmentQuantity");
        const addEquipmentButton = document.getElementById("addEquipment");
        const removeEquipmentButton = document.getElementById("removeEquipment");

        let currentRoomElement = null;

        /*async function loadSchedule(roomId) {
            const scheduleContent = document.getElementById("scheduleContent");
            let fileName = "";

            // ใช้ if...else เพื่อเลือกไฟล์สำหรับแต่ละห้อง
            if (roomId === "SC2-308") {
                fileName = "schedule308.html";
            } else if (roomId === "SC2-307") {
                fileName = "schedule307.html";
            } else if (roomId === "SC2-311") {
                fileName = "schedule311.html";
            } else {
                scheduleContent.innerHTML = `<p>ไม่มีตารางสำหรับห้อง ${roomId}</p>`;
                return; // ถ้าไม่มีตารางสำหรับห้องนั้น ให้หยุดทำงาน
            }

            try {
                // โหลดไฟล์ HTML
                const response = await fetch(fileName);
                if (!response.ok) throw new Error("ไม่สามารถโหลดไฟล์ได้");
                const content = await response.text();

                // แสดงเนื้อหาใน modal
                scheduleContent.innerHTML = content;
            } catch (error) {
                scheduleContent.innerHTML = `<p>เกิดข้อผิดพลาด: ${error.message}</p>`;
            }
        }*/

        function manageRoom(roomId) {
            currentRoomElement = document.getElementById(roomId);
            const roomName = currentRoomElement.innerText;

            // ตั้งชื่อห้องใน Modal
            roomDetailTitle.innerText = "รายละเอียดห้อง " + roomName;

            //loadSchedule(roomId);

            // เช็คสถานะปัจจุบัน (Available/Not Available)
            const currentStatus = currentRoomElement.classList.contains('available') ? 'available' : 'not-available';
            statusSelect.value = currentStatus;

            // ดึง URL จาก data-details-url
            const detailsUrl = currentRoomElement.getAttribute('data-details-url');

            // ตั้งค่า action ของ roomDetailsButton
            roomDetailsButton.onclick = function () {
                if (detailsUrl) {
                    window.location.href = detailsUrl;
                } else {
                    alert("ไม่มีรายละเอียดเพิ่มเติมสำหรับห้องนี้");
                }
            };

            //Schedule
            if (roomId === 'SC2-211') {
                scheduleButton.onclick = () => window.location.href = "Schedule211.html";
            }
            if (roomId === 'SC2-212') {
                scheduleButton.onclick = () => window.location.href = "Schedule212.html";
            }




            // แสดง Modal
            modal.style.display = "block";
        }




        // Save the room status and update the room element
        saveStatusButton.onclick = function () {
            const selectedStatus = statusSelect.value;

            // ลบข้อความสถานะเก่า
            currentRoomElement.classList.remove('available', 'not-available', 'closed');
            currentRoomElement.innerText = currentRoomElement.innerText.replace(/\s\(.*\)$/, '');

            // จัดการสถานะตามที่เลือก
            if (selectedStatus === "available") {
                currentRoomElement.classList.add('available');

            } else if (selectedStatus === "not-available") {
                currentRoomElement.classList.add('not-available');

            } else if (selectedStatus === "closed") {
                currentRoomElement.classList.add('not-available', 'closed');
                currentRoomElement.innerText += ' (ซ่อมบำรุง)';
            }

            // บันทึกสถานะลงใน LocalStorage
            localStorage.setItem(currentRoomElement.id, selectedStatus);

            // ปิด Modal
            modal.style.display = "none";
        };

        window.onclick = function (event) {
            if (event.target === modal) {
                modal.style.display = "none";
            }
        };
        // ฟังก์ชันปิด Modal
        function closeModalFunction() {
            modal.style.display = "none";
            currentRoomElement = null; // รีเซ็ตค่าห้องปัจจุบัน
        }

        // กำหนดการทำงานเมื่อกดปุ่มกากบาท
        closeModal.onclick = closeModalFunction;

        // ปิด Modal เมื่อคลิกพื้นที่นอก Modal
        window.onclick = function (event) {
            if (event.target === modal) {
                closeModalFunction();
            }
        };

        window.onload = function () {
            const rooms = document.querySelectorAll(".room");

            rooms.forEach((room) => {
                const savedStatus = localStorage.getItem(room.id);

                if (savedStatus) {
                    room.classList.remove("available", "not-available", "closed");
                    room.innerText = room.innerText.replace(/\s\(.*\)$/, '');

                    if (savedStatus === "available") {
                        room.classList.add("available");
                        room.innerText += ' ';
                    } else if (savedStatus === "not-available") {
                        room.classList.add("not-available");

                    } else if (savedStatus === "closed") {
                        room.classList.add("not-available", "closed");
                        room.innerText += ' (ซ่อมบำรุง)';
                    }
                }
            });
        };


        const searchInput = document.getElementById("searchInput");
        const reportItems = document.querySelectorAll(".report");

        searchInput.addEventListener("input", function () {
            const query = searchInput.value.toLowerCase();

            reportItems.forEach((report) => {
                const reportText = report.textContent.toLowerCase();
                if (reportText.includes(query)) {
                    report.style.display = "block";
                } else {
                    report.style.display = "none";
                }
            });
        });

        const categories = document.querySelectorAll(".categories li");
        const reports = document.querySelectorAll(".reports .report");

        categories.forEach((category) => {
            category.addEventListener("click", () => {
                category.classList.toggle("active");

                const categoryId = category.getAttribute("data-category");

                reports.forEach((report) => {
                    if (report.getAttribute("data-category") === categoryId) {
                        report.style.display = category.classList.contains("active")
                            ? "block"
                            : "none";
                    } else {
                        report.style.display = "none";
                    }
                });
            });
        });
    </script>
</body>

</html>